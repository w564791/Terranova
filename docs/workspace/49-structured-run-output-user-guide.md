# Structured Run Output ä½¿ç”¨æŒ‡å—

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-10-15  
> **çŠ¶æ€**: å¯ç”¨  
> **ç›¸å…³æ–‡æ¡£**: [47-structured-run-output-design.md](./47-structured-run-output-design.md)

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

Structured Run Output æ˜¯ä¸€ç§æ–°çš„ä»»åŠ¡æ‰§è¡Œç»“æœå±•ç¤ºæ¨¡å¼ï¼Œæä¾›ç»“æ„åŒ–çš„èµ„æºå˜æ›´è§†å›¾ï¼Œç›¸æ¯”ä¼ ç»Ÿçš„Console UIæ›´ç›´è§‚æ˜“æ‡‚ã€‚

## ğŸ¯ ä¸»è¦ç‰¹æ€§

### 1. ç»“æ„åŒ–å±•ç¤º
- ä»¥é˜¶æ®µTabæ–¹å¼å±•ç¤ºä»»åŠ¡æ‰§è¡Œæµç¨‹
- æ¸…æ™°çš„é˜¶æ®µçŠ¶æ€æŒ‡ç¤ºï¼ˆè¿›è¡Œä¸­/å®Œæˆ/ç­‰å¾…/é”™è¯¯ï¼‰
- 7ä¸ªæ‰§è¡Œé˜¶æ®µå¯è§†åŒ–

### 2. èµ„æºçº§å¯è§æ€§
- ç›´æ¥å±•ç¤ºèµ„æºå˜æ›´åˆ—è¡¨
- å¯æŠ˜å æŸ¥çœ‹æ¯ä¸ªèµ„æºçš„è¯¦ç»†å˜æ›´
- åŒºåˆ†åˆ›å»º/æ›´æ–°/åˆ é™¤/é‡å»ºæ“ä½œ

### 3. æ™ºèƒ½å¯¹æ¯”
- åªæ˜¾ç¤ºæœ‰å˜æ›´çš„å­—æ®µ
- æœªå˜æ›´å­—æ®µé»˜è®¤éšè—ï¼ˆæ˜¾ç¤ºæ•°é‡æç¤ºï¼‰
- Before/Afterå¯¹æ¯”æ¸…æ™°

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1: å¯ç”¨Structuredæ¨¡å¼

1. è®¿é—®Workspace Settingsé¡µé¢
   ```
   http://localhost:5173/workspaces/{workspace_id}?tab=settings&section=general
   ```

2. æ‰¾åˆ° **User Interface** é…ç½®é¡¹

3. é€‰æ‹© **Structured Run Output**

4. ç‚¹å‡» **Save Settings**

### æ­¥éª¤2: è¿è¡ŒPlanä»»åŠ¡

1. åœ¨Workspaceé¡µé¢ç‚¹å‡» **+ New run**

2. é€‰æ‹© **Plan** æˆ– **Plan and apply**

3. ç­‰å¾…Planæ‰§è¡Œå®Œæˆ

### æ­¥éª¤3: æŸ¥çœ‹ç»“æ„åŒ–è¾“å‡º

1. è¿›å…¥ä»»åŠ¡è¯¦æƒ…é¡µ

2. æŸ¥çœ‹7ä¸ªé˜¶æ®µTabï¼š
   - Planning
   - Post Plan
   - Plan Complete
   - Apply Pending
   - Applying
   - Post Apply
   - Complete

3. ç‚¹å‡» **Plan Complete** TabæŸ¥çœ‹èµ„æºå˜æ›´

## ğŸ“Š ç•Œé¢è¯´æ˜

### é˜¶æ®µTab

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ Planning â†’ âœ“ Post Plan â†’ [Plan Complete] â†’ â—‹ Apply... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å›¾æ ‡è¯´æ˜**:
- `âœ“` å·²å®Œæˆï¼ˆç»¿è‰²ï¼‰
- `âŸ³` è¿›è¡Œä¸­ï¼ˆè“è‰²ï¼Œè½¬åœˆåŠ¨ç”»ï¼‰
- `â—‹` ç­‰å¾…ä¸­ï¼ˆç°è‰²ï¼‰
- `âœ—` å¤±è´¥ï¼ˆçº¢è‰²ï¼‰

### Plan Complete è§†å›¾

#### æ‘˜è¦ä¿¡æ¯
```
Plan Summary
+2 to add  ~3 to change  -1 to destroy
```

#### èµ„æºåˆ—è¡¨
```
[+] module.example.aws_s3_bucket.this          CREATE    â–¶
[~] module.example.aws_iam_role.complete       UPDATE    â–¶
[-] module.example.aws_lb_listener.rule        DELETE    â–¶
[Â±] module.example.aws_instance.web            REPLACE   â–¶
```

**æ“ä½œå›¾æ ‡**:
- `[+]` åˆ›å»ºï¼ˆç»¿è‰²ï¼‰
- `[~]` æ›´æ–°ï¼ˆè“è‰²ï¼‰
- `[-]` åˆ é™¤ï¼ˆçº¢è‰²ï¼‰
- `[Â±]` é‡å»ºï¼ˆæ©™è‰²ï¼‰

#### å±•å¼€èµ„æºè¯¦æƒ…

ç‚¹å‡»èµ„æºè¡Œå¯å±•å¼€æŸ¥çœ‹è¯¦ç»†å˜æ›´ï¼š

**åˆ›å»ºæ“ä½œ**:
```
Resource will be created:
+ name: "example-bucket"
+ region: "us-east-1"
+ tags: {...}
```

**æ›´æ–°æ“ä½œ**:
```
Changed fields:
~ tags.environment:
  Before: "dev"
  After: "prod"
  
~ instance_type:
  Before: "t2.micro"
  After: "t2.small"

... 15 unchanged elements hidden
```

**åˆ é™¤æ“ä½œ**:
```
Resource will be destroyed:
- name: "old-resource"
- arn: "arn:aws:..."
```

## ğŸ”„ åˆ‡æ¢å›Console UI

å¦‚æœéœ€è¦æŸ¥çœ‹å®Œæ•´çš„Terraformæ—¥å¿—ï¼š

1. è®¿é—® Settings â†’ General

2. å°† **Run Output Display** æ”¹ä¸º **Console UI**

3. ä¿å­˜è®¾ç½®

4. åˆ·æ–°ä»»åŠ¡è¯¦æƒ…é¡µ

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### 1. å¿«é€Ÿå®šä½å˜æ›´
- ä½¿ç”¨æ‘˜è¦ä¿¡æ¯å¿«é€Ÿäº†è§£å˜æ›´è§„æ¨¡
- é€šè¿‡æ“ä½œå›¾æ ‡å¿«é€Ÿè¯†åˆ«å˜æ›´ç±»å‹
- ç‚¹å‡»èµ„æºå±•å¼€æŸ¥çœ‹è¯¦ç»†å˜æ›´

### 2. ç†è§£å˜æ›´å½±å“
- æŸ¥çœ‹Before/Afterå¯¹æ¯”äº†è§£å…·ä½“å˜æ›´
- æ³¨æ„é‡å»ºæ“ä½œï¼ˆå…ˆåˆ åå»ºï¼‰
- å…³æ³¨æœªå˜æ›´å­—æ®µæ•°é‡

### 3. å®¡æŸ¥æœ€ä½³å®è·µ
- ä»”ç»†æ£€æŸ¥åˆ é™¤æ“ä½œ
- ç¡®è®¤é‡å»ºæ“ä½œçš„å¿…è¦æ€§
- éªŒè¯æ•æ„Ÿå­—æ®µçš„å˜æ›´

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: çœ‹ä¸åˆ°èµ„æºå˜æ›´æ•°æ®

**å¯èƒ½åŸå› **:
1. Taskæ˜¯åœ¨åŠŸèƒ½å®æ–½å‰åˆ›å»ºçš„
2. å¼‚æ­¥è§£æè¿˜æœªå®Œæˆ
3. åç«¯æœåŠ¡æœªé‡å¯

**è§£å†³æ–¹æ³•**:
1. è¿è¡Œæ–°çš„Planä»»åŠ¡æµ‹è¯•
2. ç­‰å¾…å‡ ç§’ååˆ·æ–°é¡µé¢
3. é‡å¯åç«¯æœåŠ¡

### é—®é¢˜2: æ˜¾ç¤º"No resource changes detected"

**å¯èƒ½åŸå› **:
1. Planç¡®å®æ²¡æœ‰å˜æ›´
2. è§£æå¤±è´¥

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥Planè¾“å‡ºç¡®è®¤æ˜¯å¦æœ‰å˜æ›´
2. æŸ¥çœ‹åç«¯æ—¥å¿—æ˜¯å¦æœ‰è§£æé”™è¯¯
3. ä½¿ç”¨æµ‹è¯•è„šæœ¬éªŒè¯ï¼š`./scripts/test_plan_parser.sh <task_id>`

### é—®é¢˜3: åˆ‡æ¢æ¨¡å¼åæ²¡æœ‰å˜åŒ–

**å¯èƒ½åŸå› **:
1. è®¾ç½®æœªä¿å­˜
2. é¡µé¢æœªåˆ·æ–°

**è§£å†³æ–¹æ³•**:
1. ç¡®è®¤ç‚¹å‡»äº†Save Settings
2. åˆ·æ–°ä»»åŠ¡è¯¦æƒ…é¡µ

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### ä½¿ç”¨æµ‹è¯•è„šæœ¬
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x scripts/test_plan_parser.sh

# æµ‹è¯•æŒ‡å®šä»»åŠ¡
./scripts/test_plan_parser.sh <task_id>
```

### æ‰‹åŠ¨æµ‹è¯•æµç¨‹
1. åœ¨workspace 12åˆ›å»ºæ–°çš„Planä»»åŠ¡
2. ç­‰å¾…Planå®Œæˆ
3. åˆ‡æ¢åˆ°Structuredæ¨¡å¼
4. æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…é¡µ
5. éªŒè¯é˜¶æ®µTabå’Œèµ„æºå˜æ›´å±•ç¤º

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [47-structured-run-output-design.md](./47-structured-run-output-design.md) - åŠŸèƒ½è®¾è®¡
- [48-structured-run-output-implementation-progress.md](./48-structured-run-output-implementation-progress.md) - å®æ–½è¿›åº¦
- [15-terraform-execution-detail.md](./15-terraform-execution-detail.md) - Terraformæ‰§è¡Œæµç¨‹

## ğŸ“ æœ€ä½³å®è·µ

### 1. ä½•æ—¶ä½¿ç”¨Structuredæ¨¡å¼
-  éœ€è¦å¿«é€Ÿäº†è§£èµ„æºå˜æ›´
-  å®¡æŸ¥å˜æ›´è¯¦æƒ…
-  å‘éæŠ€æœ¯äººå‘˜å±•ç¤º
-  éœ€è¦æ¸…æ™°çš„é˜¶æ®µè¿›åº¦

### 2. ä½•æ—¶ä½¿ç”¨Consoleæ¨¡å¼
-  éœ€è¦å®Œæ•´çš„Terraformæ—¥å¿—
-  è°ƒè¯•æ‰§è¡Œé—®é¢˜
-  æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
-  éœ€è¦å¤åˆ¶æ—¥å¿—å†…å®¹

### 3. å›¢é˜Ÿåä½œå»ºè®®
- å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨Console UIä¾¿äºè°ƒè¯•
- ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨Structuredä¾¿äºå®¡æŸ¥
- æ ¹æ®å›¢é˜Ÿåå¥½ç»Ÿä¸€é…ç½®

##  æ³¨æ„äº‹é¡¹

1. **æ—§ä»»åŠ¡æ— æ•°æ®**: åŠŸèƒ½å®æ–½å‰çš„ä»»åŠ¡æ²¡æœ‰è§£ææ•°æ®
2. **å¼‚æ­¥å»¶è¿Ÿ**: èµ„æºå˜æ›´æ•°æ®å¯èƒ½å»¶è¿Ÿå‡ ç§’å¯ç”¨
3. **æ•°æ®ä¾èµ–**: éœ€è¦PlanæˆåŠŸå®Œæˆæ‰æœ‰æ•°æ®
4. **æ¨¡å¼ç‹¬ç«‹**: æ¯ä¸ªWorkspaceç‹¬ç«‹é…ç½®UIæ¨¡å¼

## ğŸ”® æœªæ¥åŠŸèƒ½

### å³å°†æ¨å‡º
- [ ] Applyingé˜¶æ®µå®æ—¶çŠ¶æ€æ›´æ–°
- [ ] WebSocketå®æ—¶æ¨é€èµ„æºçŠ¶æ€
- [ ] å±•å¼€æŸ¥çœ‹æœªå˜æ›´å­—æ®µ
- [ ] èµ„æºä¾èµ–å…³ç³»å›¾

### è®¡åˆ’ä¸­
- [ ] å˜æ›´å†å²å¯¹æ¯”
- [ ] å¯¼å‡ºå˜æ›´æŠ¥å‘Š
- [ ] è‡ªå®šä¹‰å±•ç¤ºå­—æ®µ
- [ ] å˜æ›´å½±å“åˆ†æ

---

**å¼€å§‹ä½¿ç”¨Structured Run Outputï¼Œä½“éªŒæ›´ç›´è§‚çš„èµ„æºå˜æ›´å±•ç¤ºï¼** ğŸš€
