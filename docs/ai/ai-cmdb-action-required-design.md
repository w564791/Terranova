# AI + CMDB é›†æˆè®¾è®¡æ–‡æ¡£ V2 - action_required å¾ªç¯æœºåˆ¶

## 1. æ¦‚è¿°

### 1.1 èƒŒæ™¯

å½“å‰ AI + CMDB é›†æˆæµç¨‹ä¸­ï¼Œå½“ç”¨æˆ·è¾“å…¥ä¿¡æ¯ä¸è¶³æ—¶ï¼Œç³»ç»Ÿè¿”å› `need_more_info` çŠ¶æ€ã€‚æœ¬è®¾è®¡æ—¨åœ¨ä¼˜åŒ–è¿™ä¸€æµç¨‹ï¼Œå¼•å…¥ `action_required` çŠ¶æ€å’Œè¡¨å•æœºåˆ¶ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿæ›´ç›´è§‚åœ°è¡¥å……ä¿¡æ¯ã€‚

### 1.2 ç›®æ ‡

1. **åœ¨ç¬¬ä¸€æ­¥åŠ è½½ Module Skill**ï¼šè·å–æ¨¡å—çš„å¿…è¦å‚æ•°å®šä¹‰
2. **å¼•å…¥ `action_required` çŠ¶æ€**ï¼šå½“ç”¨æˆ·è¾“å…¥ä¿¡æ¯ä¸è¶³æ—¶ï¼Œè¿”å›è¡¨å•è®©ç”¨æˆ·è¡¥å……
3. **æ”¯æŒ CMDB æŸ¥è¯¢**ï¼šç”¨æˆ·å¯ä»¥å¡«å†™æè¿°å…³é”®å­—ï¼ˆAI è‡ªåŠ¨ä» CMDB æŸ¥è¯¢ï¼‰æˆ–ç›´æ¥å¡«å†™ ID
4. **å¤ç”¨ç°æœ‰ AI èƒ½åŠ›**ï¼šæ‰©å±• `cmdb_need_assessment_workflow`ï¼Œä¸æ–°å¢ AI èƒ½åŠ›

### 1.3 è®¾è®¡åŸåˆ™

1. **å¤ç”¨ Module Skill**ï¼šå­—æ®µç±»å‹ã€éªŒè¯è§„åˆ™ç­‰ä¿¡æ¯ç›´æ¥æ¥è‡ª Module Skill
2. **å‰ç«¯è‡ªåŠ¨æ¸²æŸ“**ï¼šåç«¯è¿”å›å­—æ®µå®šä¹‰ï¼Œå‰ç«¯æ ¹æ®ç±»å‹è‡ªåŠ¨æ¸²æŸ“è¡¨å•
3. **çµæ´»è¾“å…¥**ï¼šç”¨æˆ·å¯ä»¥å¡«å†™æè¿°å…³é”®å­—æˆ–ç›´æ¥å¡«å†™ ID
4. **å¾ªç¯æœºåˆ¶**ï¼šæ”¯æŒå¤šè½®å¯¹è¯ï¼Œç›´åˆ°ä¿¡æ¯å®Œæ•´

---

## 2. çŠ¶æ€å®šä¹‰

### 2.1 çŠ¶æ€åˆ—è¡¨

| çŠ¶æ€ | å«ä¹‰ | è§¦å‘åœºæ™¯ |
|------|------|---------|
| `action_required` | **éœ€è¦ç”¨æˆ·æ“ä½œ** | ä¿¡æ¯ä¸è¶³ï¼Œéœ€è¦ç”¨æˆ·è¡¥å……è¡¨å• |
| `need_selection` | éœ€è¦ç”¨æˆ·é€‰æ‹© | CMDB æŸ¥è¯¢è¿”å›å¤šä¸ªç»“æœ |
| `complete` | é…ç½®ç”Ÿæˆå®Œæˆ | æ‰€æœ‰ä¿¡æ¯å……è¶³ï¼Œé…ç½®å·²ç”Ÿæˆ |
| `partial` | éƒ¨åˆ†å®Œæˆ | é…ç½®å·²ç”Ÿæˆï¼Œä½†éƒ¨åˆ†èµ„æºæœªæ‰¾åˆ° |
| `blocked` | è¯·æ±‚è¢«æ‹¦æˆª | æ„å›¾æ–­è¨€å¤±è´¥ |

### 2.2 çŠ¶æ€æµè½¬å›¾

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   ç”¨æˆ·è¯·æ±‚      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  æ­¥éª¤0:æ„å›¾æ–­è¨€  â”‚
                         â”‚  (ä»…å®‰å…¨æ£€æŸ¥)   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                           â”‚
                    â–¼                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ blocked â”‚               â”‚ æ­¥éª¤1:åŠ è½½      â”‚
              â”‚ (æ‹¦æˆª)  â”‚               â”‚ Module Skill +  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ ä¿¡æ¯å®Œæ•´æ€§æ£€æŸ¥  â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚                  â”‚                  â”‚
                              â–¼                  â–¼                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ action_required  â”‚  â”‚ ä¿¡æ¯å®Œæ•´    â”‚  â”‚ ä¸éœ€è¦ CMDB     â”‚
                    â”‚ (è¿”å›è¡¨å•)       â”‚  â”‚ ç»§ç»­æ­¥éª¤2   â”‚  â”‚ è·³è¿‡æ­¥éª¤2       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚                   â”‚                  â”‚
                             â”‚                   â”‚                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                  â”‚
                    â”‚  ç”¨æˆ·å¡«å†™è¡¨å•    â”‚         â”‚                  â”‚
                    â”‚  é‡æ–°æäº¤è¯·æ±‚    â”‚         â”‚                  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                  â”‚
                             â”‚                   â”‚                  â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
                                                 â”‚                  â”‚
                                                 â–¼                  â”‚
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
                                        â”‚ æ­¥éª¤2:CMDBæŸ¥è¯¢  â”‚         â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                                                 â”‚                  â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                              â”‚                  â”‚                  â”‚
                              â–¼                  â–¼                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
                    â”‚ need_selection   â”‚  â”‚ æŸ¥è¯¢æˆåŠŸ    â”‚           â”‚
                    â”‚ (å¤šä¸ªåŒ¹é…)       â”‚  â”‚             â”‚           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â”‚
                             â”‚                   â”‚                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                  â”‚
                    â”‚  ç”¨æˆ·é€‰æ‹©èµ„æº    â”‚         â”‚                  â”‚
                    â”‚  é‡æ–°æäº¤è¯·æ±‚    â”‚         â”‚                  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                  â”‚
                             â”‚                   â”‚                  â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                                 â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ æ­¥éª¤3:é…ç½®ç”Ÿæˆ  â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚                  â”‚                  â”‚
                              â–¼                  â–¼                  â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  complete   â”‚    â”‚   partial   â”‚    â”‚   error     â”‚
                       â”‚ (é…ç½®å®Œæˆ)  â”‚    â”‚ (éƒ¨åˆ†æœªæ‰¾åˆ°)â”‚    â”‚  (ç”Ÿæˆå¤±è´¥) â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æµç¨‹è®¾è®¡

### 3.1 æ•´ä½“æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI + CMDB é›†æˆæµç¨‹ï¼ˆV2 - å¸¦ action_required å¾ªç¯ï¼‰        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ç”¨æˆ·è¯·æ±‚                                                                    â”‚
â”‚  POST /api/v1/ai/form/generate-with-cmdb-skill-sse (SSE æ¥å£)               â”‚
â”‚  {                                                                          â”‚
â”‚    "module_id": 1,                                                          â”‚
â”‚    "user_description": "åˆ›å»ºä¸€å° ec2",                                       â”‚
â”‚    "form_data": {...},  // ç”¨æˆ·å¡«å†™çš„è¡¨å•æ•°æ®ï¼ˆå¾ªç¯æ—¶æºå¸¦ï¼‰                   â”‚
â”‚    "conversation_history": [...],  // å¯¹è¯å†å²ï¼ˆå¾ªç¯æ—¶æºå¸¦ï¼‰                  â”‚
â”‚    "context_ids": { ... }                                                   â”‚
â”‚  }                                                                          â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æ­¥éª¤ 0: æ„å›¾æ–­è¨€ (å°é©¬ç”²)                                                â”‚â”‚
â”‚  â”‚ â”œâ”€ è°ƒç”¨: GetConfigForCapability("intent_assertion")                     â”‚â”‚
â”‚  â”‚ â””â”€ å¦‚æœ is_safe=false â†’ è¿”å› blocked çŠ¶æ€ï¼Œç»ˆæ­¢æµç¨‹                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚ is_safe=true                                                        â”‚
â”‚       â–¼                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æ­¥éª¤ 1: åŠ è½½ Module Skill + CMDB éœ€æ±‚è¯„ä¼°                                â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â”‚ 1.1 åŠ è½½ Module Skill                                                   â”‚â”‚
â”‚  â”‚     - ä» module_version_skills è¡¨è·å– schema_generated_content          â”‚â”‚
â”‚  â”‚     - æå–å¿…å¡«å­—æ®µåˆ—è¡¨å’Œæ•°æ®æºæ˜ å°„                                       â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â”‚ 1.2 CMDB éœ€æ±‚è¯„ä¼°ï¼ˆå¤ç”¨ cmdb_need_assessment_workflowï¼‰                  â”‚â”‚
â”‚  â”‚     - è¾“å…¥ï¼šç”¨æˆ·æè¿° + Module Skill å†…å®¹ + è¡¨å•æ•°æ®                      â”‚â”‚
â”‚  â”‚     - è¾“å‡ºï¼š                                                            â”‚â”‚
â”‚  â”‚       {                                                                 â”‚â”‚
â”‚  â”‚         "need_cmdb": true,                                              â”‚â”‚
â”‚  â”‚         "completeness": {                                               â”‚â”‚
â”‚  â”‚           "is_complete": false,                                         â”‚â”‚
â”‚  â”‚           "missing_fields": ["name", "subnet_id", ...]                  â”‚â”‚
â”‚  â”‚         },                                                              â”‚â”‚
â”‚  â”‚         "query_plan": [...]                                             â”‚â”‚
â”‚  â”‚       }                                                                 â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â”‚ 1.3 åˆ¤æ–­ä¿¡æ¯å®Œæ•´æ€§                                                      â”‚â”‚
â”‚  â”‚     - å¦‚æœ is_complete=false â†’ è¿”å› action_required çŠ¶æ€ + è¡¨å•         â”‚â”‚
â”‚  â”‚     - å¦‚æœ is_complete=true â†’ ç»§ç»­æ­¥éª¤ 2                                â”‚â”‚
â”‚  â”‚     - å¦‚æœ need_cmdb=false â†’ ç›´æ¥è¿›å…¥æ­¥éª¤ 3 ç”Ÿæˆé…ç½®                    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚ ä¿¡æ¯å®Œæ•´ ä¸” need_cmdb=true                                          â”‚
â”‚       â–¼                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æ­¥éª¤ 2: CMDB æ‰¹é‡æŸ¥è¯¢                                                   â”‚â”‚
â”‚  â”‚ â”œâ”€ æŒ‰ query_plan æ‰§è¡Œ CMDB æŸ¥è¯¢                                         â”‚â”‚
â”‚  â”‚ â”œâ”€ å¦‚æœæœ‰å¤šä¸ªåŒ¹é… â†’ è¿”å› need_selection çŠ¶æ€                            â”‚â”‚
â”‚  â”‚ â”œâ”€ å¦‚æœéƒ¨åˆ†æœªæ‰¾åˆ° â†’ è¿”å› partial çŠ¶æ€                                   â”‚â”‚
â”‚  â”‚ â””â”€ å¦‚æœå…¨éƒ¨æ‰¾åˆ° â†’ ç»§ç»­æ­¥éª¤ 3                                            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æ­¥éª¤ 3: é…ç½®ç”Ÿæˆ                                                        â”‚â”‚
â”‚  â”‚ â”œâ”€ è°ƒç”¨: GetConfigForCapability("form_generation")                      â”‚â”‚
â”‚  â”‚ â””â”€ ç»“åˆ CMDB ç»“æœ + Module Schema ç”Ÿæˆæœ€ç»ˆé…ç½®                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚  è¿”å› complete çŠ¶æ€ + ç”Ÿæˆçš„é…ç½®                                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å¾ªç¯æœºåˆ¶è¯¦è§£

#### 3.2.1 action_required å¾ªç¯

å½“ç”¨æˆ·è¾“å…¥ä¿¡æ¯ä¸è¶³æ—¶ï¼Œç³»ç»Ÿè¿”å› `action_required` çŠ¶æ€å’Œè¡¨å•ï¼Œç”¨æˆ·å¡«å†™åé‡æ–°æäº¤ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         action_required å¾ªç¯æµç¨‹                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ç¬¬ä¸€è½®è¯·æ±‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ç”¨æˆ·: "æˆ‘éœ€è¦åˆ›å»ºä¸€å°ec2"                                               â”‚â”‚
â”‚  â”‚ form_data: {}                                                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ç³»ç»Ÿåˆ†æ: ç¼ºå°‘ name, subnet_id, vpc_security_group_ids, ami             â”‚â”‚
â”‚  â”‚ è¿”å›: action_required + è¡¨å•                                            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚  ç¬¬äºŒè½®è¯·æ±‚ï¼ˆç”¨æˆ·å¡«å†™è¡¨å•åï¼‰                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ç”¨æˆ·: "æˆ‘éœ€è¦åˆ›å»ºä¸€å°ec2"                                               â”‚â”‚
â”‚  â”‚ form_data: {                                                            â”‚â”‚
â”‚  â”‚   "name": "my-web-server",                                              â”‚â”‚
â”‚  â”‚   "subnet_id": "exchange vpc çš„ä¸œäº¬1aåŒºåŸŸ",                             â”‚â”‚
â”‚  â”‚   "vpc_security_group_ids": "Java private, web-sg",                     â”‚â”‚
â”‚  â”‚   "ami": "Amazon Linux 2"                                               â”‚â”‚
â”‚  â”‚ }                                                                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ç³»ç»Ÿåˆ†æ: ä¿¡æ¯å®Œæ•´ï¼Œç”Ÿæˆ query_plan                                     â”‚â”‚
â”‚  â”‚ ç»§ç»­: æ­¥éª¤ 2 CMDB æŸ¥è¯¢                                                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2.2 need_selection å¾ªç¯

å½“ CMDB æŸ¥è¯¢è¿”å›å¤šä¸ªåŒ¹é…ç»“æœæ—¶ï¼Œç³»ç»Ÿè¿”å› `need_selection` çŠ¶æ€ï¼Œç”¨æˆ·é€‰æ‹©åé‡æ–°æäº¤ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         need_selection å¾ªç¯æµç¨‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  CMDB æŸ¥è¯¢è¿”å›å¤šä¸ªåŒ¹é…                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æŸ¥è¯¢: "exchange vpc"                                                    â”‚â”‚
â”‚  â”‚ ç»“æœ: [                                                                 â”‚â”‚
â”‚  â”‚   {"id": "vpc-001", "name": "exchange-vpc-prod"},                       â”‚â”‚
â”‚  â”‚   {"id": "vpc-002", "name": "exchange-vpc-dev"}                         â”‚â”‚
â”‚  â”‚ ]                                                                       â”‚â”‚
â”‚  â”‚ è¿”å›: need_selection + å€™é€‰åˆ—è¡¨                                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚  ç”¨æˆ·é€‰æ‹©åé‡æ–°æäº¤                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ form_data: {                                                            â”‚â”‚
â”‚  â”‚   ...                                                                   â”‚â”‚
â”‚  â”‚   "subnet_id": "vpc-001 çš„ä¸œäº¬1aåŒºåŸŸ",  // ç”¨æˆ·æ˜ç¡®æŒ‡å®šäº† VPC            â”‚â”‚
â”‚  â”‚   ...                                                                   â”‚â”‚
â”‚  â”‚ }                                                                       â”‚â”‚
â”‚  â”‚ æˆ–è€…ç›´æ¥é€‰æ‹©:                                                           â”‚â”‚
â”‚  â”‚ selections: {                                                           â”‚â”‚
â”‚  â”‚   "vpc_id": "vpc-001"                                                   â”‚â”‚
â”‚  â”‚ }                                                                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ç³»ç»Ÿ: ä½¿ç”¨ç”¨æˆ·é€‰æ‹©çš„ VPCï¼Œç»§ç»­æŸ¥è¯¢å­ç½‘                                  â”‚â”‚
â”‚  â”‚ ç»§ç»­: æ­¥éª¤ 3 é…ç½®ç”Ÿæˆ                                                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 Module Skill åŠ è½½

ä» `module_version_skills` è¡¨åŠ è½½ Module Skillï¼Œé€šè¿‡ `module_version_id` å…³è”æŸ¥è¯¢ï¼š

```sql
-- æŸ¥è¯¢ Module Skill
SELECT schema_generated_content, custom_content
FROM module_version_skills
WHERE module_version_id = 'modv-424c6bb1a8125e9e08ea'
  AND is_active = true;
```

**æŸ¥è¯¢ç»“æœç¤ºä¾‹**ï¼š

| schema_generated_content | custom_content |
|--------------------------|----------------|
| `# ec2-ff Module Skill æ–‡æ¡£\n\n## 1. æ¨¡å—æ¦‚è¿°\n...` | `å¦‚æœéœ€è¦åˆ›å»º Spot å®ä¾‹...` |

**è¡¨ç»“æ„è¯´æ˜**ï¼š
| å­—æ®µ | è¯´æ˜ |
|------|------|
| `module_version_id` | æ¨¡å—ç‰ˆæœ¬ IDï¼ˆå¦‚ `modv-424c6bb1a8125e9e08ea`ï¼‰ |
| `schema_generated_content` | AI ç”Ÿæˆçš„ Module Skill æ–‡æ¡£å†…å®¹ |
| `custom_content` | ç”¨æˆ·è‡ªå®šä¹‰çš„è¡¥å……å†…å®¹ |
| `is_active` | æ˜¯å¦æ¿€æ´» |

ä» `schema_generated_content` ä¸­æå–ä»¥ä¸‹ä¿¡æ¯ï¼š

```markdown
# ec2-ff Module Skill æ–‡æ¡£

## 2. å‚æ•°çº¦æŸ

### å¿…å¡«å­—æ®µ
| å­—æ®µå | ç±»å‹ | éªŒè¯è§„åˆ™ | æè¿° |
|--------|------|----------|------|
| name | string | - | å®ä¾‹åç§° |
| ami | string | pattern: `^ami-` | AMIé•œåƒ |
| instance_type | string | - | å®ä¾‹ç±»å‹ |
| subnet_id | string | - | å­ç½‘ |
| vpc_security_group_ids | array | maxItems: 4 | å®‰å…¨ç»„ |
| tags | object | - | æ ‡ç­¾ |
| volume_tags | object | - | å·æ ‡ç­¾ |

## 4. æ•°æ®æºæ˜ å°„
| å­—æ®µ | æ•°æ®æº ID | API è·¯å¾„ | è¯´æ˜ |
|------|-----------|----------|------|
| ami | ami_list | /api/v1/aws/ec2/images | è·å–å¯ç”¨çš„ AMI é•œåƒåˆ—è¡¨ |
| subnet_id | subnet_list | /api/v1/aws/ec2/subnets | ä¾èµ– vpc_id |
| vpc_security_group_ids | security_groups | /api/v1/aws/ec2/security-groups | ä¾èµ– vpc_id |
```

### 3.4 å­—æ®µåˆ†ç±»è§„åˆ™

| åˆ†ç±» | åˆ¤æ–­ä¾æ® | ç¤ºä¾‹ | å¤„ç†æ–¹å¼ |
|------|---------|------|---------|
| **å¿…é¡»ç”¨æˆ·è¾“å…¥** | æ— æ•°æ®æºæ˜ å°„ | `name`, `tags` | ç”¨æˆ·å¿…é¡»å¡«å†™ |
| **å¯ä» CMDB æŸ¥è¯¢** | æœ‰æ•°æ®æºæ˜ å°„ | `subnet_id`, `vpc_security_group_ids`, `ami` | ç”¨æˆ·å¯å¡«æè¿°æˆ– ID |
| **æœ‰é»˜è®¤å€¼** | Module Skill ä¸­æ ‡æ³¨é»˜è®¤å€¼ | `instance_type` | å¯é€‰å¡«å†™ |

---

## 4. API è®¾è®¡

### 4.1 è¯·æ±‚ç»“æ„

```go
// GenerateConfigWithCMDBRequest å¸¦ CMDB æŸ¥è¯¢çš„é…ç½®ç”Ÿæˆè¯·æ±‚
type GenerateConfigWithCMDBRequest struct {
    ModuleID            uint                   `json:"module_id" binding:"required"`
    UserDescription     string                 `json:"user_description" binding:"required,max=2000"`
    FormData            map[string]interface{} `json:"form_data,omitempty"`            // ç”¨æˆ·å¡«å†™çš„è¡¨å•æ•°æ®
    Selections          map[string]string      `json:"selections,omitempty"`           // ç”¨æˆ·é€‰æ‹©çš„èµ„æºï¼ˆneed_selection æ—¶ï¼‰
    ConversationHistory []ConversationMessage  `json:"conversation_history,omitempty"` // å¯¹è¯å†å²
    ContextIDs          struct {
        WorkspaceID    string `json:"workspace_id,omitempty"`
        OrganizationID string `json:"organization_id,omitempty"`
    } `json:"context_ids,omitempty"`
}

// ConversationMessage å¯¹è¯æ¶ˆæ¯
type ConversationMessage struct {
    Role    string `json:"role"`    // "user" æˆ– "assistant"
    Content string `json:"content"` // æ¶ˆæ¯å†…å®¹
}
```

### 4.2 å“åº”ç»“æ„

```go
// GenerateConfigWithCMDBResponse å¸¦ CMDB æŸ¥è¯¢çš„é…ç½®ç”Ÿæˆå“åº”
type GenerateConfigWithCMDBResponse struct {
    Status              string                 `json:"status"`                         // action_required, need_selection, complete, partial, blocked
    Step                string                 `json:"step,omitempty"`                 // å½“å‰æ­¥éª¤ï¼šcmdb_assessment, cmdb_query, config_generation
    Config              map[string]interface{} `json:"config,omitempty"`               // ç”Ÿæˆçš„é…ç½®
    CMDBLookups         []CMDBLookupResult     `json:"cmdb_lookups,omitempty"`         // CMDB æŸ¥è¯¢è®°å½•
    Warnings            []string               `json:"warnings,omitempty"`             // è­¦å‘Šä¿¡æ¯
    Message             string                 `json:"message"`                        // æç¤ºä¿¡æ¯
    
    // action_required ç›¸å…³å­—æ®µ
    Form                *FormDefinition        `json:"form,omitempty"`                 // è¡¨å•å®šä¹‰
    ConversationHistory []ConversationMessage  `json:"conversation_history,omitempty"` // å¯¹è¯å†å²
}

// FormDefinition è¡¨å•å®šä¹‰
type FormDefinition struct {
    Title           string       `json:"title"`                      // è¡¨å•æ ‡é¢˜
    ModuleName      string       `json:"module_name"`                // æ¨¡å—åç§°
    ModuleVersionID string       `json:"module_version_id"`          // æ¨¡å—ç‰ˆæœ¬ ID
    Fields          []FormField  `json:"fields"`                     // å­—æ®µåˆ—è¡¨
}

// FormField è¡¨å•å­—æ®µ
type FormField struct {
    Field         string   `json:"field"`                    // å­—æ®µå
    Label         string   `json:"label"`                    // æ˜¾ç¤ºæ ‡ç­¾
    Type          string   `json:"type"`                     // ç±»å‹ï¼šstring, array, object, boolean, number
    Required      bool     `json:"required"`                 // æ˜¯å¦å¿…å¡«
    Description   string   `json:"description,omitempty"`    // æè¿°
    Pattern       string   `json:"pattern,omitempty"`        // éªŒè¯æ­£åˆ™
    MaxItems      int      `json:"max_items,omitempty"`      // æ•°ç»„æœ€å¤§é¡¹æ•°
    Default       any      `json:"default,omitempty"`        // é»˜è®¤å€¼
    CMDBQueryable bool     `json:"cmdb_queryable"`           // æ˜¯å¦å¯ä» CMDB æŸ¥è¯¢
    DataSource    string   `json:"data_source,omitempty"`    // æ•°æ®æº ID
    DependsOn     []string `json:"depends_on,omitempty"`     // ä¾èµ–å­—æ®µ
    Value         any      `json:"value,omitempty"`          // å½“å‰å€¼ï¼ˆç”¨æˆ·å·²å¡«å†™ï¼‰
}

// CMDBLookupResult CMDB æŸ¥è¯¢ç»“æœ
type CMDBLookupResult struct {
    Query         string             `json:"query"`                   // æŸ¥è¯¢å…³é”®è¯
    ResourceType  string             `json:"resource_type"`           // èµ„æºç±»å‹
    TargetField   string             `json:"target_field"`            // ç›®æ ‡å­—æ®µ
    FieldType     string             `json:"field_type,omitempty"`    // å‚æ•°ç±»å‹ï¼šstring æˆ– array
    SelectionMode string             `json:"selection_mode,omitempty"`// é€‰æ‹©æ¨¡å¼ï¼šsingle æˆ– multiple
    MaxSelections int                `json:"max_selections,omitempty"`// æœ€å¤§é€‰æ‹©æ•°é‡ï¼ˆä»…å¤šé€‰æ—¶æœ‰æ•ˆï¼‰
    Found         bool               `json:"found"`                   // æ˜¯å¦æ‰¾åˆ°
    Result        *CMDBResourceInfo  `json:"result,omitempty"`        // æ‰¾åˆ°çš„èµ„æº
    Candidates    []CMDBResourceInfo `json:"candidates,omitempty"`    // å€™é€‰èµ„æºï¼ˆå¤šä¸ªåŒ¹é…æ—¶ï¼‰
    Error         string             `json:"error,omitempty"`         // æŸ¥è¯¢é”™è¯¯ä¿¡æ¯
}

// CMDBResourceInfo CMDB èµ„æºä¿¡æ¯
type CMDBResourceInfo struct {
    ID            string            `json:"id"`
    Name          string            `json:"name"`
    ARN           string            `json:"arn,omitempty"`
    Region        string            `json:"region,omitempty"`
    Tags          map[string]string `json:"tags,omitempty"`
    WorkspaceID   string            `json:"workspace_id,omitempty"`
    WorkspaceName string            `json:"workspace_name,omitempty"`
}
```

### 4.3 å“åº”ç¤ºä¾‹

#### 4.3.1 action_required å“åº”ï¼ˆä¿¡æ¯ä¸è¶³ï¼‰

ç”¨æˆ·è¾“å…¥ï¼š"æˆ‘éœ€è¦åˆ›å»ºä¸€å°ec2"

```json
{
  "status": "action_required",
  "step": "cmdb_assessment",
  
  "form": {
    "title": "åˆ›å»º EC2 å®ä¾‹ - è¡¥å……ä¿¡æ¯",
    "module_name": "ec2-ff",
    "module_version_id": "modv-424c6bb1a8125e9e08ea",
    
    "fields": [
      {
        "field": "name",
        "label": "å®ä¾‹åç§°",
        "type": "string",
        "required": true,
        "description": "å®ä¾‹åç§°",
        "cmdb_queryable": false,
        "value": null
      },
      {
        "field": "ami",
        "label": "AMIé•œåƒ",
        "type": "string",
        "required": true,
        "description": "AMIé•œåƒï¼Œå¿…é¡»ä»¥ ami- å¼€å¤´",
        "pattern": "^ami-",
        "cmdb_queryable": true,
        "data_source": "ami_list",
        "value": null
      },
      {
        "field": "instance_type",
        "label": "å®ä¾‹ç±»å‹",
        "type": "string",
        "required": true,
        "description": "å®ä¾‹ç±»å‹",
        "cmdb_queryable": false,
        "data_source": "instance_types",
        "default": "t3.medium",
        "value": null
      },
      {
        "field": "subnet_id",
        "label": "å­ç½‘",
        "type": "string",
        "required": true,
        "description": "å­ç½‘",
        "cmdb_queryable": true,
        "data_source": "subnet_list",
        "depends_on": ["vpc_id"],
        "value": null
      },
      {
        "field": "vpc_security_group_ids",
        "label": "å®‰å…¨ç»„",
        "type": "array",
        "required": true,
        "description": "å®‰å…¨ç»„",
        "max_items": 4,
        "cmdb_queryable": true,
        "data_source": "security_groups",
        "depends_on": ["vpc_id"],
        "value": null
      },
      {
        "field": "tags",
        "label": "æ ‡ç­¾",
        "type": "object",
        "required": true,
        "description": "æ ‡ç­¾",
        "cmdb_queryable": false,
        "default": {"business-line": "", "managed-by": "terraform"},
        "value": null
      },
      {
        "field": "volume_tags",
        "label": "å·æ ‡ç­¾",
        "type": "object",
        "required": true,
        "description": "å·æ ‡ç­¾",
        "cmdb_queryable": false,
        "default": {"business-line": "", "managed-by": "terraform"},
        "value": null
      }
    ]
  },
  
  "message": "è¯·å¡«å†™ä»¥ä¸‹è¡¨å•ä¿¡æ¯ã€‚å¯¹äºå¯ä» CMDB æŸ¥è¯¢çš„å­—æ®µï¼Œæ‚¨å¯ä»¥å¡«å†™æè¿°å…³é”®å­—æˆ–ç›´æ¥å¡«å†™ IDã€‚",
  "conversation_history": [
    {"role": "user", "content": "æˆ‘éœ€è¦åˆ›å»ºä¸€å°ec2"}
  ]
}
```

#### 4.3.2 need_selection å“åº”ï¼ˆå¤šä¸ªåŒ¹é…ï¼‰

å½“ CMDB æŸ¥è¯¢è¿”å›å¤šä¸ªåŒ¹é…ç»“æœæ—¶ï¼Œéœ€è¦æ ¹æ® Module Skill ä¸­çš„å‚æ•°ç±»å‹æ¥å†³å®šå‰ç«¯æ˜¯å•é€‰è¿˜æ˜¯å¤šé€‰ï¼š

| å‚æ•°ç±»å‹ | é€‰æ‹©æ¨¡å¼ | è¯´æ˜ |
|---------|---------|------|
| `string` | **å•é€‰** | åªèƒ½é€‰æ‹©ä¸€ä¸ªèµ„æºï¼Œå¦‚ `subnet_id`ã€`vpc_id` |
| `array` | **å¤šé€‰** | å¯ä»¥é€‰æ‹©å¤šä¸ªèµ„æºï¼Œå¦‚ `vpc_security_group_ids` |

**å•é€‰ç¤ºä¾‹**ï¼ˆ`subnet_id` æ˜¯ string ç±»å‹ï¼‰ï¼š

```json
{
  "status": "need_selection",
  "step": "cmdb_query",
  
  "cmdb_lookups": [
    {
      "query": "exchange vpc çš„ä¸œäº¬1aåŒºåŸŸ",
      "resource_type": "aws_subnet",
      "target_field": "subnet_id",
      "field_type": "string",
      "selection_mode": "single",
      "found": true,
      "candidates": [
        {"id": "subnet-001", "name": "tokyo-1a-private-1", "tags": {"Environment": "production"}},
        {"id": "subnet-002", "name": "tokyo-1a-private-2", "tags": {"Environment": "development"}}
      ]
    }
  ],
  
  "message": "æ‰¾åˆ°å¤šä¸ªåŒ¹é…çš„å­ç½‘ï¼Œè¯·é€‰æ‹©ä¸€ä¸ª",
  "conversation_history": [...]
}
```

**å¤šé€‰ç¤ºä¾‹**ï¼ˆ`vpc_security_group_ids` æ˜¯ array ç±»å‹ï¼‰ï¼š

```json
{
  "status": "need_selection",
  "step": "cmdb_query",
  
  "cmdb_lookups": [
    {
      "query": "Java",
      "resource_type": "aws_security_group",
      "target_field": "vpc_security_group_ids",
      "field_type": "array",
      "selection_mode": "multiple",
      "max_selections": 4,
      "found": true,
      "candidates": [
        {"id": "sg-001", "name": "java-private-sg", "tags": {"App": "java"}},
        {"id": "sg-002", "name": "java-public-sg", "tags": {"App": "java"}},
        {"id": "sg-003", "name": "java-internal-sg", "tags": {"App": "java"}}
      ]
    }
  ],
  
  "message": "æ‰¾åˆ°å¤šä¸ªåŒ¹é…çš„å®‰å…¨ç»„ï¼Œè¯·é€‰æ‹©ï¼ˆæœ€å¤š 4 ä¸ªï¼‰",
  "conversation_history": [...]
}
```

**CMDBLookupResult æ‰©å±•å­—æ®µ**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `field_type` | string | å‚æ•°ç±»å‹ï¼š`string` æˆ– `array` |
| `selection_mode` | string | é€‰æ‹©æ¨¡å¼ï¼š`single`ï¼ˆå•é€‰ï¼‰æˆ– `multiple`ï¼ˆå¤šé€‰ï¼‰ |
| `max_selections` | int | æœ€å¤§é€‰æ‹©æ•°é‡ï¼ˆä»…å¤šé€‰æ—¶æœ‰æ•ˆï¼Œæ¥è‡ª Module Skill çš„ `maxItems`ï¼‰ |

#### 4.3.3 complete å“åº”ï¼ˆé…ç½®ç”Ÿæˆå®Œæˆï¼‰

```json
{
  "status": "complete",
  "step": "config_generation",
  
  "config": {
    "name": "my-web-server",
    "ami": "ami-0123456789abcdef0",
    "instance_type": "t3.medium",
    "subnet_id": "subnet-abc123",
    "vpc_security_group_ids": ["sg-java123"],
    "tags": {"business-line": "web", "managed-by": "terraform"},
    "volume_tags": {"business-line": "web", "managed-by": "terraform"}
  },
  
  "cmdb_lookups": [
    {
      "query": "exchange vpc çš„ä¸œäº¬1aåŒºåŸŸ",
      "resource_type": "aws_subnet",
      "target_field": "subnet_id",
      "found": true,
      "result": {"id": "subnet-abc123", "name": "tokyo-1a-private"}
    },
    {
      "query": "Java private",
      "resource_type": "aws_security_group",
      "target_field": "vpc_security_group_ids",
      "found": true,
      "result": {"id": "sg-java123", "name": "java-private-sg"}
    }
  ],
  
  "message": "é…ç½®å·²ç”Ÿæˆï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹èµ„æºæ˜¯å¦æ­£ç¡®"
}
```

#### 4.3.4 partial å“åº”ï¼ˆéƒ¨åˆ†èµ„æºæœªæ‰¾åˆ°ï¼‰

```json
{
  "status": "partial",
  "step": "cmdb_query",
  
  "config": {
    "name": "my-web-server",
    "ami": "ami-0123456789abcdef0",
    "instance_type": "t3.medium",
    "subnet_id": "<RESOURCE_NOT_FOUND:subnet>",
    "vpc_security_group_ids": ["sg-java123"],
    "tags": {"business-line": "web", "managed-by": "terraform"},
    "volume_tags": {"business-line": "web", "managed-by": "terraform"}
  },
  
  "cmdb_lookups": [
    {
      "query": "ä¸å­˜åœ¨çš„å­ç½‘",
      "resource_type": "aws_subnet",
      "target_field": "subnet_id",
      "found": false,
      "error": "æœªæ‰¾åˆ°åŒ¹é…çš„å­ç½‘"
    },
    {
      "query": "Java private",
      "resource_type": "aws_security_group",
      "target_field": "vpc_security_group_ids",
      "found": true,
      "result": {"id": "sg-java123", "name": "java-private-sg"}
    }
  ],
  
  "warnings": ["æœªæ‰¾åˆ°åŒ¹é… 'ä¸å­˜åœ¨çš„å­ç½‘' çš„å­ç½‘ï¼Œè¯·æ‰‹åŠ¨å¡«å†™ subnet_id"],
  "message": "é…ç½®å·²ç”Ÿæˆï¼Œä½†éƒ¨åˆ†èµ„æºæœªæ‰¾åˆ°ï¼Œè¯·æ£€æŸ¥å¹¶è¡¥å……"
}
```

#### 4.3.5 blocked å“åº”ï¼ˆè¯·æ±‚è¢«æ‹¦æˆªï¼‰

```json
{
  "status": "blocked",
  "step": "intent_assertion",
  "message": "æˆ‘æ˜¯ IaC å¹³å°çš„ AI åŠ©æ‰‹ï¼Œä¸“æ³¨äºå¸®åŠ©æ‚¨ç®¡ç†äº‘åŸºç¡€è®¾æ–½ã€‚è¯·é—®æ‚¨éœ€è¦ä»€ä¹ˆ Terraform é…ç½®å¸®åŠ©ï¼Ÿ"
}
```

---

## 5. å‰ç«¯è®¾è®¡

### 5.1 è¡¨å•æ¸²æŸ“è§„åˆ™

å‰ç«¯æ ¹æ®è¿”å›çš„ `form.fields` è‡ªåŠ¨æ¸²æŸ“è¡¨å•ï¼š

| å­—æ®µç±»å‹ | `cmdb_queryable` | æ¸²æŸ“æ–¹å¼ |
|---------|-----------------|---------|
| `string` | `true` | è¾“å…¥æ¡† + æç¤º"å¯å¡«æè¿°å…³é”®å­—æˆ–ç›´æ¥å¡«å†™ ID" |
| `string` | `false` | æ™®é€šè¾“å…¥æ¡† |
| `array` | `true` | è¾“å…¥æ¡† + æç¤º"å¤šä¸ªå€¼ç”¨åˆ†éš”ç¬¦åˆ†éš”ï¼Œå¯å¡«æè¿°æˆ– ID" |
| `array` | `false` | å¤šå€¼è¾“å…¥æ¡† |
| `object` | - | é”®å€¼å¯¹ç¼–è¾‘å™¨ |
| `boolean` | - | å¼€å…³ |
| `number` | - | æ•°å­—è¾“å…¥æ¡† |

### 5.2 è¡¨å•å±•ç¤ºæ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– AI åŠ©æ‰‹ - åˆ›å»º EC2 å®ä¾‹                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  è¯·å¡«å†™ä»¥ä¸‹ä¿¡æ¯ã€‚å¯¹äºå¯ä» CMDB æŸ¥è¯¢çš„å­—æ®µï¼Œæ‚¨å¯ä»¥å¡«å†™æè¿°å…³é”®å­—   â”‚
â”‚  æˆ–ç›´æ¥å¡«å†™ IDã€‚                                                 â”‚
â”‚                                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚                                                                 â”‚
â”‚  å®ä¾‹åç§° *                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  EC2 å®ä¾‹çš„åç§°æ ‡è¯†                                              â”‚
â”‚                                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚                                                                 â”‚
â”‚  å­ç½‘ *  ğŸ’¡ å¯å¡«æè¿°å…³é”®å­—æˆ–ç›´æ¥å¡«å†™ ID                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  ä¾‹å¦‚ï¼šexchange vpc çš„ä¸œäº¬1aåŒºåŸŸ | subnet-0123456789abcdef0     â”‚
â”‚                                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚                                                                 â”‚
â”‚  å®‰å…¨ç»„ *  ğŸ’¡ å¤šä¸ªå€¼ç”¨åˆ†éš”ç¬¦åˆ†éš”ï¼Œå¯å¡«æè¿°æˆ– ID                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  ä¾‹å¦‚ï¼šJava private, web-sg | sg-001, sg-002                    â”‚
â”‚  æœ€å¤š 4 ä¸ªå®‰å…¨ç»„                                                 â”‚
â”‚                                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚                                                                 â”‚
â”‚  AMIé•œåƒ *  ğŸ’¡ å¯å¡«æè¿°å…³é”®å­—æˆ–ç›´æ¥å¡«å†™ ID                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  ä¾‹å¦‚ï¼šAmazon Linux 2 | ami-0123456789abcdef0                   â”‚
â”‚                                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚                                                                 â”‚
â”‚  å®ä¾‹ç±»å‹ï¼ˆé»˜è®¤ï¼št3.mediumï¼‰                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ t3.medium                                                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚                                                                 â”‚
â”‚                                              [å–æ¶ˆ]  [æäº¤]     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 ç”¨æˆ·è¾“å…¥å¤„ç†

#### 5.3.1 æ•°ç»„ç±»å‹åˆ†éš”ç¬¦å¤„ç†

åç«¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒå¤šç§åˆ†éš”ç¬¦ï¼š

```go
// æ”¯æŒçš„åˆ†éš”ç¬¦ï¼šé€—å·ã€åˆ†å·ã€ç©ºæ ¼ã€æ¢è¡Œã€ä¸­æ–‡é€—å·ç­‰
func parseArrayInput(input string) []string {
    re := regexp.MustCompile(`[,;ï¼Œï¼›\s]+`)
    parts := re.Split(input, -1)
    
    var result []string
    for _, part := range parts {
        trimmed := strings.TrimSpace(part)
        if trimmed != "" {
            result = append(result, trimmed)
        }
    }
    return result
}
```

**ç¤ºä¾‹**ï¼š
- è¾“å…¥ï¼š`"Java private, web-sg"` â†’ `["Java private", "web-sg"]`
- è¾“å…¥ï¼š`"sg-001 sg-002"` â†’ `["sg-001", "sg-002"]`
- è¾“å…¥ï¼š`"å…è®¸SSHçš„å®‰å…¨ç»„ï¼›å…è®¸HTTPçš„å®‰å…¨ç»„"` â†’ `["å…è®¸SSHçš„å®‰å…¨ç»„", "å…è®¸HTTPçš„å®‰å…¨ç»„"]`

#### 5.3.2 ID ä¸æè¿°å…³é”®å­—åˆ¤æ–­

åç«¯æ ¹æ®è¾“å…¥æ ¼å¼åˆ¤æ–­æ˜¯ ID è¿˜æ˜¯æè¿°å…³é”®å­—ï¼š

```go
func isResourceID(input string, resourceType string) bool {
    patterns := map[string]string{
        "aws_vpc":            `^vpc-[a-f0-9]+$`,
        "aws_subnet":         `^subnet-[a-f0-9]+$`,
        "aws_security_group": `^sg-[a-f0-9]+$`,
        "aws_ami":            `^ami-[a-f0-9]+$`,
        "aws_iam_role":       `^arn:aws:iam::\d+:role/.+$`,
    }
    
    if pattern, ok := patterns[resourceType]; ok {
        matched, _ := regexp.MatchString(pattern, input)
        return matched
    }
    return false
}
```

---

## 6. æ‰©å±• cmdb_need_assessment_workflow

### 6.1 æ‰©å±• Prompt

åœ¨ç°æœ‰ `cmdb_need_assessment_workflow` Skill çš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä»¥ä¸‹å†…å®¹ï¼š

```markdown
## æ–°å¢ï¼šä¿¡æ¯å®Œæ•´æ€§è¯„ä¼°

åœ¨åˆ¤æ–­æ˜¯å¦éœ€è¦ CMDB çš„åŒæ—¶ï¼Œè¿˜éœ€è¦è¯„ä¼°ç”¨æˆ·æä¾›çš„ä¿¡æ¯æ˜¯å¦å®Œæ•´ã€‚

### è¾“å…¥

é™¤äº†ç”¨æˆ·æè¿°ï¼Œè¿˜ä¼šæä¾›ï¼š

1. **Module Skill å†…å®¹**ï¼ˆå¿…å¡«å­—æ®µå’Œæ•°æ®æºæ˜ å°„ï¼‰ï¼š
\`\`\`
{{module_skill_content}}
\`\`\`

2. **ç”¨æˆ·å·²å¡«å†™çš„è¡¨å•æ•°æ®**ï¼ˆå¦‚æœæœ‰ï¼‰ï¼š
\`\`\`
{{form_data}}
\`\`\`

### æ‰©å±•è¾“å‡ºæ ¼å¼

\`\`\`json
{
  "need_cmdb": true/false,
  "reason": "...",
  "resource_types": [...],
  "query_plan": [...],
  
  "completeness": {
    "is_complete": true/false,
    "missing_fields": ["ç¼ºå¤±çš„å¿…å¡«å­—æ®µåˆ—è¡¨"],
    "provided_values": {
      "å­—æ®µå": "ç”¨æˆ·æä¾›çš„å€¼ï¼ˆæè¿°æˆ–IDï¼‰"
    }
  }
}
\`\`\`

### åˆ¤æ–­è§„åˆ™

1. **å¿…å¡«å­—æ®µæ£€æŸ¥**ï¼šå¯¹æ¯” Module Skill çš„å¿…å¡«å­—æ®µåˆ—è¡¨ï¼Œæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æä¾›äº†æ‰€æœ‰å¿…å¡«å­—æ®µ
2. **å€¼ç±»å‹åˆ¤æ–­**ï¼š
   - å¦‚æœå€¼åŒ¹é… ID æ ¼å¼ï¼ˆå¦‚ `vpc-xxx`ã€`subnet-xxx`ï¼‰â†’ ç›´æ¥ä½¿ç”¨
   - å¦‚æœå€¼æ˜¯æè¿°å…³é”®å­— â†’ ç”Ÿæˆ query_plan
3. **ä¾èµ–å…³ç³»å¤„ç†**ï¼šå¦‚æœå­—æ®µæœ‰ `depends_on`ï¼Œéœ€è¦å…ˆè·å–ä¾èµ–å­—æ®µçš„å€¼
```

### 6.2 ç¤ºä¾‹

**è¾“å…¥**ï¼š
- ç”¨æˆ·æè¿°ï¼š"æˆ‘éœ€è¦åˆ›å»ºä¸€å°ec2"
- Module Skillï¼šEC2 æ¨¡å—çš„å‚æ•°å®šä¹‰
- è¡¨å•æ•°æ®ï¼š`{}`ï¼ˆç©ºï¼‰

**è¾“å‡º**ï¼š
```json
{
  "need_cmdb": true,
  "reason": "ç”¨æˆ·è¦åˆ›å»º EC2ï¼Œéœ€è¦ VPCã€å­ç½‘ã€å®‰å…¨ç»„ç­‰èµ„æº",
  "resource_types": ["aws_vpc", "aws_subnet", "aws_security_group", "aws_ami"],
  "query_plan": [],
  
  "completeness": {
    "is_complete": false,
    "missing_fields": ["name", "ami", "subnet_id", "vpc_security_group_ids"],
    "provided_values": {}
  }
}
```

**è¾“å…¥**ï¼ˆç”¨æˆ·å¡«å†™è¡¨å•åï¼‰ï¼š
- ç”¨æˆ·æè¿°ï¼š"æˆ‘éœ€è¦åˆ›å»ºä¸€å°ec2"
- Module Skillï¼šEC2 æ¨¡å—çš„å‚æ•°å®šä¹‰
- è¡¨å•æ•°æ®ï¼š
  ```json
  {
    "name": "my-web-server",
    "subnet_id": "exchange vpc çš„ä¸œäº¬1aåŒºåŸŸ",
    "vpc_security_group_ids": "Java private, web-sg",
    "ami": "Amazon Linux 2"
  }
  ```

**è¾“å‡º**ï¼š
```json
{
  "need_cmdb": true,
  "reason": "ç”¨æˆ·æä¾›äº† CMDB æŸ¥è¯¢å…³é”®å­—",
  "resource_types": ["aws_vpc", "aws_subnet", "aws_security_group", "aws_ami"],
  "query_plan": [
    {
      "resource_type": "aws_vpc",
      "target_field": "vpc_id",
      "filters": {"name_contains": "exchange"}
    },
    {
      "resource_type": "aws_subnet",
      "target_field": "subnet_id",
      "filters": {"name_contains": "ä¸œäº¬1a"},
      "depends_on": "vpc_id"
    },
    {
      "resource_type": "aws_security_group",
      "target_field": "vpc_security_group_ids",
      "filters": {"name_contains": "Java private"}
    },
    {
      "resource_type": "aws_security_group",
      "target_field": "vpc_security_group_ids",
      "filters": {"name_contains": "web-sg"}
    },
    {
      "resource_type": "aws_ami",
      "target_field": "ami",
      "filters": {"name_contains": "Amazon Linux 2"}
    }
  ],
  
  "completeness": {
    "is_complete": true,
    "missing_fields": [],
    "provided_values": {
      "name": "my-web-server",
      "subnet_id": "exchange vpc çš„ä¸œäº¬1aåŒºåŸŸ",
      "vpc_security_group_ids": ["Java private", "web-sg"],
      "ami": "Amazon Linux 2"
    }
  }
}
```

---

## 7. å®ç°è®¡åˆ’

### 7.1 æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `backend/services/ai_cmdb_skill_service.go` | ä¿®æ”¹ | æ·»åŠ  action_required çŠ¶æ€å¤„ç† |
| `backend/services/ai_cmdb_skill_service_sse.go` | ä¿®æ”¹ | SSE ç‰ˆæœ¬åŒæ­¥ä¿®æ”¹ |
| `backend/controllers/ai_cmdb_controller.go` | ä¿®æ”¹ | æ·»åŠ  form_data å’Œ selections å‚æ•°å¤„ç† |
| `scripts/update_cmdb_need_assessment_workflow.sql` | æ–°å¢ | æ›´æ–° Skill Prompt |
| `frontend/src/components/OpenAPIFormRenderer/AIFormAssistant/` | ä¿®æ”¹ | æ”¯æŒ action_required çŠ¶æ€å’Œè¡¨å•æ¸²æŸ“ |

### 7.2 å®ç°æ­¥éª¤

| æ­¥éª¤ | å†…å®¹ | å·¥ä½œé‡ |
|------|------|--------|
| 1 | æ›´æ–° `cmdb_need_assessment_workflow` Skill Prompt | 0.5å¤© |
| 2 | ä¿®æ”¹åç«¯æœåŠ¡ï¼Œæ·»åŠ  Module Skill åŠ è½½å’Œä¿¡æ¯å®Œæ•´æ€§æ£€æŸ¥ | 1å¤© |
| 3 | ä¿®æ”¹åç«¯æœåŠ¡ï¼Œæ·»åŠ  action_required çŠ¶æ€å¤„ç† | 0.5å¤© |
| 4 | ä¿®æ”¹åç«¯æ§åˆ¶å™¨ï¼Œæ”¯æŒ form_data å’Œ selections å‚æ•° | 0.5å¤© |
| 5 | å‰ç«¯æ”¯æŒ action_required çŠ¶æ€å’Œè¡¨å•æ¸²æŸ“ | 1å¤© |
| 6 | æµ‹è¯•å’Œä¼˜åŒ– | 0.5å¤© |

**æ€»è®¡: çº¦ 4 å¤©**

---

## 8. é£é™©å’Œç¼“è§£æªæ–½

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| AI è§£æè¡¨å•æ•°æ®ä¸å‡†ç¡® | ç”Ÿæˆé”™è¯¯çš„ query_plan | è¿”å›æŸ¥è¯¢ç»“æœè®©ç”¨æˆ·ç¡®è®¤ |
| å¾ªç¯æ¬¡æ•°è¿‡å¤š | ç”¨æˆ·ä½“éªŒå·® | é™åˆ¶æœ€å¤§å¾ªç¯æ¬¡æ•°ï¼ˆå»ºè®® 3 æ¬¡ï¼‰ |
| Module Skill å†…å®¹ä¸å®Œæ•´ | æ— æ³•æ­£ç¡®åˆ¤æ–­å¿…å¡«å­—æ®µ | ä½¿ç”¨ Schema ä½œä¸ºå¤‡é€‰æ•°æ®æº |
| å‰ç«¯è¡¨å•æ¸²æŸ“å¤æ‚ | å¼€å‘å·¥ä½œé‡å¤§ | å¤ç”¨ç°æœ‰çš„ OpenAPIFormRenderer ç»„ä»¶ |

---

## 9. ç”¨æˆ·ä½“éªŒä¼˜åŒ–å»ºè®®

é€šè¿‡é˜…è¯»ç°æœ‰ä»£ç ï¼Œå‘ç°ä»¥ä¸‹å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ç”¨æˆ·ä½“éªŒçš„ç‚¹ï¼š

### 9.1 ç°æœ‰ä»£ç åˆ†æ

å½“å‰ä»£ç æµç¨‹ï¼š
1. **æ„å›¾æ–­è¨€** â†’ æ£€æŸ¥è¯·æ±‚å®‰å…¨æ€§
2. **CMDB åˆ¤æ–­** â†’ å…³é”®è¯æ£€æµ‹ + AI è¯­ä¹‰åˆ†æ
3. **CMDB æŸ¥è¯¢** â†’ æ‰§è¡ŒæŸ¥è¯¢ï¼Œè¿”å› `need_selection` æˆ–ç»§ç»­
4. **é…ç½®ç”Ÿæˆ** â†’ è°ƒç”¨ AI ç”Ÿæˆé…ç½®

**é—®é¢˜**ï¼šå½“å‰æµç¨‹æ²¡æœ‰åœ¨ç¬¬ä¸€æ­¥æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„å®Œæ•´æ€§ï¼Œç›´æ¥è¿›å…¥ CMDB æŸ¥è¯¢ã€‚å¦‚æœç”¨æˆ·è¾“å…¥ä¿¡æ¯ä¸è¶³ï¼Œä¼šå¯¼è‡´ï¼š
- CMDB æŸ¥è¯¢å¤±è´¥æˆ–è¿”å›ä¸ç›¸å…³çš„ç»“æœ
- AI ç”Ÿæˆçš„é…ç½®ç¼ºå°‘å¿…è¦å­—æ®µ

### 9.2 ä¼˜åŒ–ç‚¹

#### 9.2.1 æå‰åŠ è½½ Module Skill è¿›è¡Œä¿¡æ¯å®Œæ•´æ€§æ£€æŸ¥

**ç°çŠ¶**ï¼šModule Skill åœ¨æ­¥éª¤ 4ï¼ˆç»„è£… Promptï¼‰æ—¶æ‰åŠ è½½
**ä¼˜åŒ–**ï¼šåœ¨æ­¥éª¤ 1ï¼ˆæ„å›¾æ–­è¨€åï¼‰å°±åŠ è½½ Module Skillï¼Œæå–å¿…å¡«å­—æ®µï¼Œæ£€æŸ¥ç”¨æˆ·è¾“å…¥æ˜¯å¦å®Œæ•´

```go
// ä¼˜åŒ–åçš„æµç¨‹
func (s *AICMDBSkillService) GenerateConfigWithCMDBSkillOptimizedV2(...) {
    // æ­¥éª¤ 0: æ„å›¾æ–­è¨€
    // ...
    
    // æ­¥éª¤ 1: åŠ è½½ Module Skill + ä¿¡æ¯å®Œæ•´æ€§æ£€æŸ¥ [æ–°å¢]
    moduleSkill := s.loadModuleSkill(moduleID)
    completeness := s.checkCompleteness(userDescription, formData, moduleSkill)
    if !completeness.IsComplete {
        return &GenerateConfigWithCMDBResponse{
            Status: "action_required",
            Form:   s.buildFormFromModuleSkill(moduleSkill, completeness.MissingFields),
        }, nil
    }
    
    // æ­¥éª¤ 2: CMDB æŸ¥è¯¢ï¼ˆåªæœ‰ä¿¡æ¯å®Œæ•´æ—¶æ‰æ‰§è¡Œï¼‰
    // ...
}
```

#### 9.2.2 SSE è¿›åº¦åé¦ˆä¼˜åŒ–

**ç°çŠ¶**ï¼šè¿›åº¦åé¦ˆåªæœ‰ 5 ä¸ªæ­¥éª¤
**ä¼˜åŒ–**ï¼šå¢åŠ  `action_required` çŠ¶æ€çš„è¿›åº¦åé¦ˆ

```go
// æ–°å¢è¿›åº¦äº‹ä»¶ç±»å‹
type ProgressEvent struct {
    Type           string          `json:"type"`           // progress, need_selection, action_required, complete
    Step           int             `json:"step"`
    TotalSteps     int             `json:"total_steps"`
    StepName       string          `json:"step_name"`
    Message        string          `json:"message"`
    CompletedSteps []CompletedStep `json:"completed_steps,omitempty"`
    Form           *FormDefinition `json:"form,omitempty"` // action_required æ—¶è¿”å›è¡¨å•
}
```

#### 9.2.3 è¡¨å•å­—æ®µæ™ºèƒ½é¢„å¡«

**ä¼˜åŒ–**ï¼šä»ç”¨æˆ·æè¿°ä¸­æå–å·²çŸ¥ä¿¡æ¯ï¼Œé¢„å¡«åˆ°è¡¨å•ä¸­

```go
// ç¤ºä¾‹ï¼šç”¨æˆ·è¾“å…¥ "åˆ›å»ºä¸€å° t3.large çš„ ec2"
// AI åˆ†æåï¼Œinstance_type å­—æ®µå¯ä»¥é¢„å¡« "t3.large"
completeness := {
    "is_complete": false,
    "missing_fields": ["name", "subnet_id", "vpc_security_group_ids"],
    "provided_values": {
        "instance_type": "t3.large"  // ä»ç”¨æˆ·æè¿°ä¸­æå–
    }
}
```

#### 9.2.4 CMDB æŸ¥è¯¢ç»“æœç¼“å­˜

**ç°çŠ¶**ï¼šæ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°æŸ¥è¯¢ CMDB
**ä¼˜åŒ–**ï¼šå¯¹äºåŒä¸€ä¼šè¯ï¼Œç¼“å­˜ CMDB æŸ¥è¯¢ç»“æœï¼Œé¿å…é‡å¤æŸ¥è¯¢

```go
// åœ¨ action_required å¾ªç¯ä¸­ï¼Œç”¨æˆ·å¡«å†™è¡¨å•åé‡æ–°æäº¤
// å¦‚æœç”¨æˆ·åªæ˜¯è¡¥å……äº† name å­—æ®µï¼Œä¸éœ€è¦é‡æ–°æŸ¥è¯¢ CMDB
// å¯ä»¥å¤ç”¨ä¹‹å‰çš„ CMDB æŸ¥è¯¢ç»“æœ
```

#### 9.2.5 è¡¨å•éªŒè¯å‰ç½®

**ä¼˜åŒ–**ï¼šåœ¨å‰ç«¯æäº¤å‰è¿›è¡ŒåŸºç¡€éªŒè¯ï¼Œå‡å°‘æ— æ•ˆè¯·æ±‚

```typescript
// å‰ç«¯éªŒè¯è§„åˆ™ï¼ˆæ¥è‡ª Module Skillï¼‰
const validateForm = (formData: FormData, fields: FormField[]) => {
    const errors: Record<string, string> = {};
    
    for (const field of fields) {
        const value = formData[field.field];
        
        // å¿…å¡«æ£€æŸ¥
        if (field.required && !value) {
            errors[field.field] = `${field.label} æ˜¯å¿…å¡«é¡¹`;
            continue;
        }
        
        // æ­£åˆ™éªŒè¯
        if (field.pattern && value) {
            const regex = new RegExp(field.pattern);
            if (!regex.test(value)) {
                errors[field.field] = `${field.label} æ ¼å¼ä¸æ­£ç¡®`;
            }
        }
        
        // æ•°ç»„æœ€å¤§é¡¹æ•°æ£€æŸ¥
        if (field.type === 'array' && field.max_items && value) {
            const items = parseArrayInput(value);
            if (items.length > field.max_items) {
                errors[field.field] = `${field.label} æœ€å¤š ${field.max_items} é¡¹`;
            }
        }
    }
    
    return errors;
};
```

### 9.3 ä¼˜åŒ–åçš„ç”¨æˆ·ä½“éªŒæµç¨‹

```
ç”¨æˆ·è¾“å…¥: "åˆ›å»ºä¸€å° ec2"
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 1: ä¿¡æ¯å®Œæ•´æ€§æ£€æŸ¥                                           â”‚
â”‚ - åŠ è½½ Module Skill                                             â”‚
â”‚ - æ£€æŸ¥å¿…å¡«å­—æ®µ: name, ami, subnet_id, vpc_security_group_ids    â”‚
â”‚ - ç»“æœ: ä¿¡æ¯ä¸å®Œæ•´                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿”å› action_required + è¡¨å•                                      â”‚
â”‚ - è¡¨å•å­—æ®µæ¥è‡ª Module Skill                                      â”‚
â”‚ - å¯ä» CMDB æŸ¥è¯¢çš„å­—æ®µæ ‡è®° cmdb_queryable: true                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
ç”¨æˆ·å¡«å†™è¡¨å•:
  - name: "my-web-server"
  - subnet_id: "exchange vpc çš„ä¸œäº¬1aåŒºåŸŸ"
  - vpc_security_group_ids: "Java private, web-sg"
  - ami: "Amazon Linux 2"
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 1: ä¿¡æ¯å®Œæ•´æ€§æ£€æŸ¥                                           â”‚
â”‚ - ç»“æœ: ä¿¡æ¯å®Œæ•´                                                 â”‚
â”‚ - ç”Ÿæˆ query_plan                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 2: CMDB æŸ¥è¯¢                                                â”‚
â”‚ - æŸ¥è¯¢ subnet: "exchange vpc çš„ä¸œäº¬1aåŒºåŸŸ"                       â”‚
â”‚ - æŸ¥è¯¢ security_group: "Java private", "web-sg"                 â”‚
â”‚ - æŸ¥è¯¢ ami: "Amazon Linux 2"                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€â”€ å¤šä¸ªåŒ¹é… â”€â”€â†’ è¿”å› need_selection + å€™é€‰åˆ—è¡¨
    â”‚                  ç”¨æˆ·é€‰æ‹©åé‡æ–°æäº¤
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 3: é…ç½®ç”Ÿæˆ                                                 â”‚
â”‚ - ç»“åˆ CMDB ç»“æœ + Module Schema ç”Ÿæˆé…ç½®                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
è¿”å› complete + ç”Ÿæˆçš„é…ç½®
```

### 9.4 é¢„æœŸæ•ˆæœ

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| ç”¨æˆ·è¾“å…¥ä¸è¶³æ—¶çš„åé¦ˆ | ç”Ÿæˆä¸å®Œæ•´çš„é…ç½® | è¿”å›è¡¨å•è®©ç”¨æˆ·è¡¥å…… |
| CMDB æŸ¥è¯¢å¤±è´¥ç‡ | è¾ƒé«˜ï¼ˆä¿¡æ¯ä¸è¶³ï¼‰ | è¾ƒä½ï¼ˆä¿¡æ¯å®Œæ•´åæ‰æŸ¥è¯¢ï¼‰ |
| ç”¨æˆ·æ“ä½œæ¬¡æ•° | å¤šæ¬¡å°è¯• | ä¸€æ¬¡è¡¨å•å¡«å†™ |
| é”™è¯¯æç¤ºæ¸…æ™°åº¦ | æ¨¡ç³Š | æ˜ç¡®æŒ‡å‡ºç¼ºå°‘å“ªäº›å­—æ®µ |

---

## 10. é™„å½•

### 9.1 çŠ¶æ€ç å¯¹ç…§è¡¨

| çŠ¶æ€ | HTTP çŠ¶æ€ç  | è¯´æ˜ |
|------|------------|------|
| `action_required` | 200 | éœ€è¦ç”¨æˆ·è¡¥å……ä¿¡æ¯ |
| `need_selection` | 200 | éœ€è¦ç”¨æˆ·é€‰æ‹©èµ„æº |
| `complete` | 200 | é…ç½®ç”Ÿæˆå®Œæˆ |
| `partial` | 200 | éƒ¨åˆ†å®Œæˆ |
| `blocked` | 200 | è¯·æ±‚è¢«æ‹¦æˆª |

### 9.2 ç›¸å…³æ–‡æ¡£

- [AI + CMDB é›†æˆè®¾è®¡æ–‡æ¡£ V1](./ai-cmdb-integration-design.md)
- [CMDB å‘é‡åŒ–æœç´¢æ–¹æ¡ˆ](./cmdb-vector-search-design.md)
- [Module Skill ç”Ÿæˆæœºåˆ¶](./module-skill-generator.md)
