# 模块 AI 提示词功能设计文档

## 1. 功能概述

### 1.1 目标
在模块详情页面（`/modules/:id`）添加 AI 提示词管理功能，允许管理员为每个模块配置自定义提示词，帮助用户在使用 AI 助手时获得参考。

### 1.2 用户场景
- **管理员**：为模块配置常用的提示词示例，如"创建生产环境 EC2"、"配置高可用架构"等
- **普通用户**：在模块详情页查看提示词，了解如何更好地使用 AI 助手

---

## 2. 数据模型设计

### 2.1 数据库变更

**表**: `modules`

**新增字段**:
| 字段名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `ai_prompts` | JSONB | `'[]'` | AI 提示词列表 |

**数据结构**:
```json
[
  {
    "id": "uuid-1",
    "title": "创建生产环境 EC2",
    "prompt": "在 exchange VPC 的东京1a创建一台 ec2，安全组使用 java-private，主机名称使用 xxx，使用 t3.medium 类型",
    "created_at": "2026-01-26T12:00:00Z"
  },
  {
    "id": "uuid-2", 
    "title": "创建开发环境配置",
    "prompt": "创建一个开发环境的配置，使用 t3.small 实例类型，启用调试模式",
    "created_at": "2026-01-26T12:30:00Z"
  }
]
```

### 2.2 SQL 迁移脚本

```sql
-- scripts/add_ai_prompts_to_modules.sql
ALTER TABLE modules 
ADD COLUMN IF NOT EXISTS ai_prompts JSONB DEFAULT '[]';

COMMENT ON COLUMN modules.ai_prompts IS 'AI 助手提示词列表，格式: [{"id": "uuid", "title": "标题", "prompt": "提示词内容", "created_at": "时间"}]';
```

---

## 3. 后端设计

### 3.1 模型更新

**文件**: `backend/internal/models/module.go`

```go
type Module struct {
    // ... 现有字段
    AIPrompts datatypes.JSON `json:"ai_prompts" gorm:"type:jsonb;default:'[]'"`
}

// AIPrompt 提示词结构
type AIPrompt struct {
    ID        string    `json:"id"`
    Title     string    `json:"title"`
    Prompt    string    `json:"prompt"`
    CreatedAt time.Time `json:"created_at"`
}
```

### 3.2 API 说明

无需新增 API，复用现有的模块更新接口：

**更新模块** `PUT /api/v1/modules/:id`

请求体示例：
```json
{
  "ai_prompts": [
    {
      "id": "uuid-1",
      "title": "创建生产环境 EC2",
      "prompt": "在 exchange VPC 的东京1a创建一台 ec2...",
      "created_at": "2026-01-26T12:00:00Z"
    }
  ]
}
```

---

## 4. 前端设计

### 4.1 类型定义

**文件**: `frontend/src/services/modules.ts`

```typescript
export interface AIPrompt {
  id: string;
  title: string;
  prompt: string;
  created_at: string;
}

export interface Module {
  // ... 现有字段
  ai_prompts?: AIPrompt[];
}
```

### 4.2 UI 设计

#### 4.2.1 提示词区块位置

在 ModuleDetail 页面的 `quickActions` 区块下方，`infoBar` 区块上方添加提示词区块。

#### 4.2.2 提示词区块布局

```
┌─────────────────────────────────────────────────────────────────────┐
│ 💡 AI 助手提示词                                      [+ 添加提示词] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ 创建生产环境 EC2                                              │  │
│  │ ─────────────────────────────────────────────────────────────  │  │
│  │ 在 exchange VPC 的东京1a创建一台 ec2，安全组使用 java-private │  │
│  │ ，主机名称使用 xxx，使用 t3.medium 类型                       │  │
│  │                                                    [编辑][删除]│  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                     │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ 创建开发环境配置                                              │  │
│  │ ─────────────────────────────────────────────────────────────  │  │
│  │ 创建一个开发环境的配置，使用 t3.small 实例类型                │  │
│  │                                                    [编辑][删除]│  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

#### 4.2.3 空状态设计

```
┌─────────────────────────────────────────────────────────────────────┐
│ 💡 AI 助手提示词                                      [+ 添加提示词] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│                          💡                                         │
│                                                                     │
│              添加提示词，帮助用户更好地使用 AI 助手                 │
│                                                                     │
│                     [添加第一个提示词]                              │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

#### 4.2.4 添加/编辑模态框

```
┌─────────────────────────────────────────────────────────────────────┐
│ 添加提示词                                                      [×] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  标题 *                                                             │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 创建生产环境 EC2                                            │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  提示词内容 *                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 在 exchange VPC 的东京1a创建一台 ec2，安全组使用            │   │
│  │ java-private，主机名称使用 xxx，使用 t3.medium 类型         │   │
│  │                                                             │   │
│  │                                                             │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│                                          [取消]  [保存]             │
└─────────────────────────────────────────────────────────────────────┘
```

### 4.3 交互流程

#### 4.3.1 添加提示词
1. 用户点击"添加提示词"按钮
2. 弹出模态框，填写标题和内容
3. 点击"保存"，前端生成 UUID，调用模块更新 API
4. 成功后刷新页面数据，显示新提示词

#### 4.3.2 编辑提示词
1. 用户点击提示词卡片上的"编辑"按钮
2. 弹出模态框，预填充现有数据
3. 修改后点击"保存"，调用模块更新 API
4. 成功后刷新页面数据

#### 4.3.3 删除提示词
1. 用户点击提示词卡片上的"删除"按钮
2. 弹出确认对话框
3. 确认后从数组中移除该提示词，调用模块更新 API
4. 成功后刷新页面数据

---

## 5. 文件修改清单

| 文件路径 | 操作 | 说明 |
|----------|------|------|
| `scripts/add_ai_prompts_to_modules.sql` | 新建 | 数据库迁移脚本 |
| `backend/internal/models/module.go` | 修改 | 添加 AIPrompts 字段 |
| `frontend/src/services/modules.ts` | 修改 | 添加 AIPrompt 类型定义 |
| `frontend/src/pages/ModuleDetail.tsx` | 修改 | 添加提示词区块和 CRUD 功能 |
| `frontend/src/pages/ModuleDetail.module.css` | 修改 | 添加提示词相关样式 |

---

## 6. 样式规范

### 6.1 颜色
- 区块背景：`#f9fafb`
- 卡片背景：`#ffffff`
- 卡片边框：`#e5e7eb`
- 标题颜色：`#111827`
- 内容颜色：`#6b7280`
- 主题色（按钮）：`#6366f1`

### 6.2 间距
- 区块内边距：`20px`
- 卡片间距：`12px`
- 卡片内边距：`16px`

### 6.3 圆角
- 区块圆角：`12px`
- 卡片圆角：`8px`
- 按钮圆角：`6px`

---

## 7. 后续扩展（可选）

1. **提示词排序**：支持拖拽排序
2. **提示词分类**：按场景分类（如：创建、修改、查询）
3. **提示词模板变量**：支持 `{{变量}}` 语法
4. **提示词使用统计**：记录提示词被查看/使用的次数
