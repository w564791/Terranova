# 17 — AI 分析 + Embedding（用户侧）

> 源文件: `router_ai.go`
> API 数量: 12

## 全部 API 列表

### AI 分析

| # | Method | Path | 认证 | 授权 | 状态 |
|---|--------|------|------|------|------|
| 1 | POST | /api/v1/ai/analyze-error | JWT+AuditLogger | admin绕过 / AI_ANALYSIS/ORG/WRITE或ADMIN | ✅ |
| 2 | POST | /api/v1/ai/form/generate | JWT+AuditLogger | 同上 | ✅ |
| 3 | POST | /api/v1/ai/form/generate-with-cmdb | JWT+AuditLogger | 同上 | ✅ |
| 4 | POST | /api/v1/ai/form/generate-with-cmdb-skill | JWT+AuditLogger | 同上 | ✅ |
| 5 | POST | /api/v1/ai/form/generate-with-cmdb-skill-sse | JWT+AuditLogger | 同上 | ✅ |
| 6 | POST | /api/v1/ai/skill/preview-prompt | JWT+AuditLogger | admin绕过 / AI_ANALYSIS/ORG/ADMIN | ✅ |

### Embedding

| # | Method | Path | 认证 | 授权 | 状态 |
|---|--------|------|------|------|------|
| 7 | GET | /api/v1/ai/embedding/config-status | JWT+AuditLogger | 无IAM | ⚠️ 缺权限检查 |
| 8 | POST | /api/v1/ai/cmdb/vector-search | JWT+AuditLogger | admin绕过 / AI_ANALYSIS/ORG/READ或WRITE或ADMIN | ✅ |

### Workspace Embedding

| # | Method | Path | 认证 | 授权 | 状态 |
|---|--------|------|------|------|------|
| 9 | GET | /api/v1/workspaces/:id/embedding-status | JWT+AuditLogger | admin绕过 / WORKSPACE/WS/READ+ | ✅ |
| 10 | POST | /api/v1/workspaces/:id/embedding/sync | JWT+AuditLogger | admin绕过 / WORKSPACE/WS/WRITE+ | ✅ |
| 11 | POST | /api/v1/workspaces/:id/embedding/rebuild | JWT+AuditLogger | admin绕过 / WORKSPACE/WS/ADMIN | ✅ |

## 需修复项 (#7)

### GET /ai/embedding/config-status
- **问题**: 与同组其他接口不一致，缺少 IAM 权限检查
- **修复**: 添加 admin 绕过 + IAM: AI_ANALYSIS/ORG/READ
- **文件**: `router_ai.go`
