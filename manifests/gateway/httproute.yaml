# 前端路由（兜底）
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: iac-frontend
  namespace: terraform
  labels:
    app.kubernetes.io/name: iac-platform
spec:
  parentRefs:
    - name: iac-platform
      sectionName: https
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: iac-frontend
          port: 443
---
# 后端 API 路由
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: iac-platform-api
  namespace: terraform
  labels:
    app.kubernetes.io/name: iac-platform
spec:
  parentRefs:
    - name: iac-platform
      sectionName: https
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /api/
      timeouts:
        request: 600s
        backendRequest: 600s
      backendRefs:
        - name: iac-platform
          port: 8080
    - matches:
        - path:
            type: PathPrefix
            value: /health
      backendRefs:
        - name: iac-platform
          port: 8080
